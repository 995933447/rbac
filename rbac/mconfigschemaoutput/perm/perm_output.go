// Code generated by protoc-gen-easymicro-jsonschema. DO NOT EDIT.
package main

import (
	"fmt"
	"log"

	"github.com/995933447/rbac/rbac"
	"github.com/995933447/runtimeutil"
	"github.com/invopop/jsonschema"
	jsoniter "github.com/json-iterator/go"
)

type ConfigSchemaOutput struct {
	Table         string             `json:"table"`
	IndexKeys     []string           `json: "index_keys"`
	UniqIndexKeys []string           `json:"uniq_index_keys"`
	JsonSchema    *jsonschema.Schema `json: "schema"`
}

func main() {
	jsonSchema := getJsonSchema()
	configSchemaOutput := &ConfigSchemaOutput{
		Table: rbac.PermTbName,
		IndexKeys: []string{
			"scope",
			"name",
			"pid",
		},
		UniqIndexKeys: []string{
			"perm_id",
			"perm_id,resource_route",
			"scope,resource_route",
			"scope,name",
		},
		JsonSchema: jsonSchema,
	}
	s, err := jsoniter.MarshalToString(configSchemaOutput)
	if err != nil {
		log.Fatal(runtimeutil.NewStackErr(err))
	}
	fmt.Print(s)
}

func getJsonSchema() *jsonschema.Schema {
	r := &jsonschema.Reflector{}
	r.DoNotReference = true
	r.AllowAdditionalProperties = true
	r.RequiredFromJSONSchemaTags = true
	r.FieldNameTag = "bson"
	return r.Reflect(&rbac.PermOrm{})
}
